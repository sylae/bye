<!DOCTYPE html>
<html>
  <head>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="/js/jquery.min.js" type="text/javascript" charset="UTF-8"></script>
    <link href="/css/bootstrap.css" rel="stylesheet" />
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery.autoheight.js"></script>
    <script src="/node_modules/socket.io-client/socket.io.js"></script>
    <title>sylae/bye</title>
    <script>
      function toggle(selector) {
        if ($(selector).css('opacity') != 0) {
          $(selector).css('opacity', 0);
        } else {
          $(selector).css('opacity', 1);
        }
      }
      function forceOff(selector) {
        $(selector).css('opacity', 0);
      }

      function updateBracket(force) {
        // surely there is a better way
        $('#bracket iframe').attr('src', $('#bracket iframe').attr('src'));
      }
      function updateStandings(force) {
        if (force || $("#standings .panel").css("opacity") != 0) {
          $.getJSON("/standings.php", function (data) {
            $("#standings tbody").empty();
            $.each(data, function (id, payload) {
              var line = $("<tr />");
              $("<td />", {
                id: id,
                style: 'text-align: left;',
                text: payload['name']
              }).appendTo(line);
              $("<td />", {text: payload['w']}).appendTo(line);
              $("<td />", {text: payload['l']}).appendTo(line);
              $("<td />", {text: payload['pct']}).appendTo(line);
              $("<td />", {text: payload['sets']}).appendTo(line);
              $("<td />", {text: payload['pts']}).appendTo(line);
              $("<td />", {text: payload['diff']}).appendTo(line);
              line.appendTo("#standings tbody");
            });
          });
        }
      }
      function updateScorebug(force) {
        if (force || $("#scorebug .panel").css("opacity") != 0) {
          $.getJSON("/match.php?match=active", function (data) {
            console.log(data);
            $("#scorebug #tname").html(data.title);
            $("#scorebug #mname").html(data.match);
            $("#scorebug #score_p1").html(data.p1);
            $("#scorebug #score_p1p1").html(data.p1pts.r1);
            $("#scorebug #score_p1p2").html(data.p1pts.r2);
            $("#scorebug #score_p1p3").html(data.p1pts.r3);
            $("#scorebug #score_p2").html(data.p2);
            $("#scorebug #score_p2p1").html(data.p2pts.r1);
            $("#scorebug #score_p2p2").html(data.p2pts.r2);
            $("#scorebug #score_p2p3").html(data.p2pts.r3);
          });
        }
      }
      $(document).ready(function () {
        updateStandings(true);
        window.setInterval(updateStandings, 15000);
        updateScorebug(true);
        window.setInterval(updateScorebug, 15000);
        var socket = io('http://localhost:3000'); // @TODO: config
        socket.on('streamctrl', function (msg) {
          var payload = JSON.parse(msg);
          console.log(payload);
          if (payload.type == 17 && payload.value == 1) {
            switch (payload.id) {
              case 11: // sys mute
                toggleAudio("sys");
                break;
              case 12: // mic mute
                toggleAudio("mic");
                break;
              case 13: // SHIT
                App.setPrimaryMicEnabled(false);
                App.setPrimarySpeakerEnabled(false);
                switchScene("SHIT !");
                break;
              case 8: // Break1
                switchScene("Break 1");
                break;
              case 9: // Break2
                switchScene("Break 2");
                break;
              case 10: // Break3
                switchScene("Break 3");
                break;
              case 5: // Decklink
                switchScene("Desktop");
                break;
              case 6: // Aux1
                switchScene("Aux 1");
                break;
              case 7: // Aux2
                switchScene("Aux 2");
                break;
              case 2: // Opt1
                toggle("#standings .panel");
                forceOff("#scorebug .panel");
                forceOff("#bracket .panel");
                updateStandings(true);
                break;
              case 3: // Opt2
                forceOff("#standings .panel");
                toggle("#scorebug .panel");
                forceOff("#bracket .panel");
                updateSorebug(true);
                break;
              case 4: // Opt3
                forceOff("#standings .panel");
                forceOff("#scorebug .panel");
                toggle("#bracket .panel");
                updateBracket(true);
                break;
              default:
                break;
            }
          } else if (payload.type == 16) {
            var v = ((payload.value + 1) * 100 / 1024);
            switch (payload.id) {
              case 4: // sys volume
                App.setPrimarySpeakerLevel(v);
                break;
              case 5: // mic volume
                App.setPrimaryMicLevel(v);
                break;
              case 3: // dog opacity
                break;
              case 2: // opt1 opacity
                break;
              case 0: // opt2 opacity
                break;
              case 1: // opt3 opacity
                break;
              default:
                break;
            }
          }
        });
      });
    </script>
    <meta charset="UTF-8" />
    <style>
      .carousel .item {
        padding-top: 20px;
        padding-bottom: 20px;
      }
      .carousel-inner {
        background: url("/img/crtv hex corner-line.png");
        left: -150px;
      }
      .carousel .item p {
        margin: 5px;
      }
      .byePanel {
        background: url('/img/rocket_bg.png') no-repeat scroll right top, url('/img/stripe.png') no-repeat scroll left top, rgba(21, 21, 21, 0.7);
      }
      #marquee {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: url('/img/crtv hex corner.png') no-repeat scroll right top / contain;
        opacity: 0.7;
        color: #fff;
      }
      #standings {
        position: absolute;
        left: 5%;
        bottom: 10%;
        width: 30%;
      }
      #scorebug {
        position: absolute;
        left: 5%;
        bottom: 10%;
        width: 30%;
      }
      #bracket {
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
        left: 0%;
        bottom: 0%;
        width: 100%;
        height: 100%;
      }
      #bracket > .panel {
        width: 65%;
      }
    </style>
  </head>
  <body style="background:url('https://c312441.ssl.cf1.rackcdn.com/boot/img/bg3_s.png');">
    <div class="container" id="bracket">
      <div class="panel panel-default" style="background: rgba(0,0,0,0);transition: opacity 1s ease-in-out;opacity:0;">
        <table class="table byePanel">
          <thead>
            <tr>
              <th width="100%">BRACKET</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><iframe class="autoHeight" src="bracket_iframe.php" width="100%" height="750" frameborder="0" scrolling="no" allowtransparency="true"></iframe></td>
            </tr>
          </tbody>
        </table>
        <div style="background: rgba(21, 21, 21, 0.7);">
          <div class="panel-footer" style="background: rgba(21, 21, 21, 0.7);">
            <span class="pull-right"><small>Powered by Challonge <img src="img/challonge.png" style="height:1em" alt="" /></small></span><br />
          </div>
        </div>
      </div>
    </div>
    <div class="container" id="standings">
      <div class="panel panel-default" style="background: rgba(0,0,0,0);transition: opacity 1s ease-in-out;opacity:0;">
        <table class="table byePanel">
          <thead>
            <tr>
              <th width="100%">STANDINGS</th>
              <th style="text-align: center;">W</th>
              <th style="text-align: center;">L</th>
              <th style="text-align: center;">Pct</th>
              <th style="text-align: center;">Sets</th>
              <th style="text-align: center;">Goals</th>
              <th style="text-align: center;">Diff</th>
            </tr>
          </thead>
          <tbody style="text-align: center;">
          </tbody>
        </table>
        <div style="background: rgba(21, 21, 21, 0.7);">
          <div class="panel-footer" style="background: rgba(21, 21, 21, 0.5);">
            <span class="pull-right"><small>Powered by Challonge <img src="/img/challonge.png" style="height:1em" alt="" /></small></span>
            <br />
          </div>
        </div>
      </div>
    </div>
    <div class="container" id="scorebug">
      <div class="panel panel-default" style="background: rgba(0,0,0,0);transition: opacity 1s ease-in-out;opacity:0;">
        <table class="table byePanel">
          <thead>
            <tr>
              <th width="100%" colspan="4">
                <small>
                  <small style="text-transform: uppercase;" id="tname"><?php echo $data['name']; ?></small>
                </small>
                <br />
                <h5 id="mname"><?php echo $loser ?>Round <?php echo $match['round']; ?>, Match <?php echo $match['identifier']; ?></h5>
              </th>
          </thead>
          <tbody style="text-align: center;">
            <tr>
              <th><h4 id="score_p1"><?php echo $score['p1']; ?></h4></th>
              <td><h4 id="score_p1p1"><?php echo $score['p1pts']['1']; ?></h4></td>
              <td><h4 id="score_p1p2"><?php echo $score['p1pts']['2']; ?></h4></td>
              <td><h4 id="score_p1p3"><?php echo $score['p1pts']['3']; ?></h4></td>
            </tr>
            <tr>
              <th><h4 id="score_p2"><?php echo $score['p2']; ?></h4></th>
              <td><h4 id="score_p2p1"><?php echo $score['p2pts']['1']; ?></h4></td>
              <td><h4 id="score_p2p2"><?php echo $score['p2pts']['2']; ?></h4></td>
              <td><h4 id="score_p2p3"><?php echo $score['p2pts']['3']; ?></h4></td>
            </tr>
          </tbody>
        </table>
        <div style="background: rgba(21, 21, 21, 0.7);">
          <div class="panel-footer" style="background: rgba(21, 21, 21, 0.7);">
            <span class="pull-right"><small>Powered by Challonge <img src="img/challonge.png" style="height:1em" alt="" /></small></span><br />
          </div>
        </div>
      </div>
    </div>
    <div id="marquee">
      <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox" id="ticker">
          <div class="item static active">
            <p class="text-center">We love hearing your feedback! Shoot us a line at crtv@calref.net.</p>
          </div>
          <div class="item static">
            <p class="text-center">Want to know when we're broadcasting? Follow us on the Youtube for notifications!</p>
          </div>
          <div class="item static">
            <p class="text-center">Have some spare toxic attitude? Send it to us via @CalRefTV on the Twitter.</p>
          </div>
          <div class="item">
            <p class="text-center">Test4</p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

